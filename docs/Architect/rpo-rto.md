# RPO / RTO 定義

## RPO（Recovery Point Objective：目標復旧時点）

### 定義
**RPO = 1 日**

システム障害が発生した際に、最大で 1 日前のデータまで復旧可能であることを目標とします。

### 設定理由

1. **データの重要度**
   - 本システムは主に個人のメモ・タスク管理と出品情報を扱います
   - 1 日分のデータ損失は許容範囲内と判断

2. **バックアップコスト**
   - 1 日 1 回のバックアップで十分なバランスを実現
   - より頻繁なバックアップはコストと運用負荷が増加

3. **ユーザー影響**
   - メモやタスクは通常、1 日以内に再入力可能
   - 出品情報も再投稿可能な範囲

### 実現方法

- **データベース**: 1 日 1 回の自動バックアップ（PostgreSQL `pg_dump`）
- **オブジェクトストレージ**: 1 日 1 回の自動バックアップ（MinIO バケットコピー）
- **バックアップ保存期間**: 30 日間（1 ヶ月分のバックアップを保持）

## RTO（Recovery Time Objective：目標復旧時間）

### 定義
**RTO = 4 ～ 8 時間**

システム障害が発生してから、サービスを完全に復旧するまでの目標時間を 4 ～ 8 時間とします。

### 設定理由

1. **システム規模**
   - 小規模な Web アプリケーション
   - 複雑な依存関係が少ないため、比較的迅速な復旧が可能

2. **運用体制**
   - 開発チームが対応可能な範囲
   - 24 時間体制の監視は不要（開発・展示用途）

3. **ユーザー影響**
   - 展示用途のため、数時間のダウンタイムは許容可能
   - 本番環境では、より短い RTO（1 ～ 2 時間）を目指す

### 実現方法

1. **障害検知**
   - 監視ツール（例: Uptime Robot, Pingdom）による自動検知
   - メール・Slack 通知による即座のアラート

2. **復旧手順**
   - 標準化された復旧手順書の整備
   - バックアップからのリストア手順の自動化（スクリプト化）

3. **復旧時間の内訳**
   - 障害検知: 5 ～ 15 分
   - 原因調査: 1 ～ 2 時間
   - バックアップリストア: 30 分 ～ 1 時間
   - 動作確認・テスト: 30 分 ～ 1 時間
   - サービス再開: 即座
   - **合計: 4 ～ 8 時間**

## 災害復旧戦略

### レベル 1: データベース障害
- **RTO**: 2 ～ 4 時間
- **手順**: 最新バックアップから PostgreSQL をリストア

### レベル 2: オブジェクトストレージ障害
- **RTO**: 1 ～ 2 時間
- **手順**: バックアップから MinIO バケットを復元

### レベル 3: バックエンドサーバー障害
- **RTO**: 30 分 ～ 1 時間
- **手順**: Docker コンテナの再起動、または新しいサーバーへのデプロイ

### レベル 4: フロントエンド障害（GitHub Pages）
- **RTO**: 数分 ～ 30 分
- **手順**: GitHub Actions による自動再デプロイ

### レベル 5: 完全なシステム障害
- **RTO**: 4 ～ 8 時間
- **手順**: 全コンポーネントの順次復旧

## バックアップ戦略との連携

- **RPO 1 日**: 1 日 1 回のバックアップで達成
- **RTO 4 ～ 8 時間**: 自動化されたリストア手順で達成
- **テスト**: 四半期ごとに災害復旧訓練を実施

## 将来の改善案

### 本番環境での目標値
- **RPO**: 1 時間（より頻繁なバックアップ）
- **RTO**: 1 ～ 2 時間（自動化と冗長化の強化）

### 実現方法
- **データベースレプリケーション**: マスター・スレーブ構成でリアルタイム同期
- **マルチリージョンデプロイ**: 地理的に分散したサーバーで冗長化
- **自動フェイルオーバー**: 障害時の自動切り替え
- **継続的バックアップ**: トランザクションログのリアルタイムバックアップ

