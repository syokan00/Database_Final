# 環境変数の設定方法

## 重要な注意事項

**`.env` ファイルは GitHub にアップロードされません。** これは意図的な設計です。

- `.env` ファイルには機密情報（データベースパスワード、JWT シークレットなど）が含まれます
- `.gitignore` ファイルに `.env` が含まれているため、Git はこのファイルを無視します
- 代わりに、`.env.example` ファイルをテンプレートとして使用します

## セットアップ手順

### 1. `.env.example` を `.env` にコピー

```bash
cd backend
cp env.example .env
```

### 2. `.env` ファイルを編集

`.env` ファイルを開き、実際の値を設定してください：

```env
# データベース設定
# Docker環境の場合（docker-compose.yml のポートマッピングに合わせる）
DATABASE_URL=postgresql://postgres:changeme@localhost:5433/memoluck

# ローカル環境の場合
# DATABASE_URL=postgresql://postgres:your-password@localhost:5432/memolucky

# Redis設定
# Docker環境の場合
REDIS_URL=redis://localhost:6380/0

# MinIO設定
# Docker環境の場合
MINIO_ENDPOINT=localhost:9002
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=changeme

# JWT設定（本番環境では強力なランダム文字列に変更）
JWT_SECRET=your-strong-random-secret-key-here
```

### 3. 機密情報の扱い

以下の値は必ず変更してください：

- `JWT_SECRET`: 本番環境では強力なランダム文字列を使用
- `DATABASE_URL`: データベースのパスワードを含む
- `MINIO_SECRET_KEY`: MinIO のシークレットキー

## Docker環境での設定

`docker-compose.yml` を使用している場合、環境変数は以下のように設定されます：

- **PostgreSQL**: `localhost:5433` → コンテナ内 `5432`
- **Redis**: `localhost:6380` → コンテナ内 `6379`
- **MinIO**: `localhost:9002` → コンテナ内 `9000`

`.env` ファイルでは、ホストマシンからアクセスする際のポートを使用してください。

## 本番環境での設定

本番環境では、以下の方法で環境変数を設定します：

1. **環境変数として直接設定**（推奨）
2. **シークレット管理サービスを使用**（AWS Secrets Manager、HashiCorp Vault など）
3. **CI/CD パイプラインの Secrets を使用**（GitHub Actions、GitLab CI など）

`.env` ファイルを本番環境に直接配置することは避けてください。

## `.env.example` の更新

プロジェクトに新しい環境変数を追加する場合：

1. `.env.example` ファイルを更新（プレースホルダー値を使用）
2. README またはこのドキュメントに説明を追加
3. `.env` ファイルは更新しない（各開発者が自分で設定）

## トラブルシューティング

### 問題: `.env` ファイルが Git に追加されてしまう

**解決策**: `.gitignore` ファイルに `.env` が含まれていることを確認してください。

```bash
# .gitignore を確認
cat .gitignore | grep .env
```

### 問題: 環境変数が読み込まれない

**解決策**:
1. `.env` ファイルが `backend/` ディレクトリに存在することを確認
2. ファイル名が正確に `.env` であることを確認（`.env.txt` などではない）
3. バックエンドコンテナを再起動: `docker restart database_final-main-backend-1`

## まとめ

- ✅ `.env.example` を GitHub にアップロード（テンプレートとして）
- ❌ `.env` を GitHub にアップロードしない（`.gitignore` で除外）
- ✅ 各開発者がローカルで `.env` を作成して設定
- ✅ 本番環境では環境変数やシークレット管理サービスを使用

